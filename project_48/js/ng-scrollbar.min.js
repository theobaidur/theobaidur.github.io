/**
 * ng-scrollbar
 * @version v0.0.5 - 2014-09-29
 * @link https://github.com/asafdav/ng-scrollbar
 * @author Asaf David <asafdav@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("ngScrollbar",[]).directive("ngScrollbar",["$parse","$window",function(a,b){return{restrict:"A",replace:!0,transclude:!0,scope:{showYScrollbar:"=?isBarShown"},link:function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p={bottom:d.hasOwnProperty("bottom")},q=angular.element(b),r={top:0},s={top:0},t=function(){k={position:"relative",overflow:"hidden","max-width":"100%",height:"100%"},s.height&&(k.height=s.height+"px"),l={position:"absolute",height:r.height+"px",top:r.top+"px"},m={position:"relative","line-height":r.height+"px"},n={position:"relative",top:s.top+"px",overflow:"hidden"}},u=function(){h.css("top",r.top+"px");var a=r.top/s.height;s.top=-Math.round(s.scrollHeight*a),f.css("top",s.top+"px")},v=function(a){var b=a.hasOwnProperty("offsetY")?a.offsetY:a.layerY,c=Math.max(0,Math.min(parseInt(r.trackHeight,10)-parseInt(r.height,10),b));r.top=c,u(),a.stopPropagation()},w=function(a){var b=20,c=void 0!==a.wheelDeltaY?a.wheelDeltaY/b:void 0!==a.wheelDelta?a.wheelDelta/b:-a.detail*(b/10);return r.top=Math.max(0,Math.min(parseInt(s.height,10)-parseInt(r.height,10),parseInt(r.top,10)-c)),u(),a.preventDefault?void a.preventDefault():!1},x=0,y=function(a,b,c){r.top=Math.max(0,Math.min(parseInt(r.trackHeight,10)-parseInt(r.height,10),c)),a.stopPropagation()},z=function(a){var b=0,c=a.pageY-h[0].scrollTop-x;y(a,b,c),u()},A=function(a){q.off("mousemove",z),q.off("mouseup",A),a.stopPropagation()},B=function(a){var b=0,c=a.originalEvent.changedTouches[0].pageY-h[0].scrollTop-x;y(a,b,c),u()},C=function(a){q.off("touchmove",B),q.off("touchend",C),a.stopPropagation()},D=function(b){var d=c[0].parentElement.offsetTop,o=void 0!==q[0].onmousewheel?"mousewheel":"DOMMouseScroll";b=p.bottom||b,e=angular.element(c.children()[0]),f=angular.element(e.children()[0]),g=angular.element(e.children()[1]),h=angular.element(angular.element(g.children()[0]).children()[0]),i=angular.element(h.children()[0]),j=angular.element(angular.element(g.children()[0]).children()[1]),s.height=c[0].offsetHeight-d,s.height<0&&(s.height=c[0].offsetHeight),s.scrollHeight=f[0].scrollHeight,s.height<s.scrollHeight?(a.showYScrollbar=!0,a.$emit("scrollbar.show"),r.height=Math.round(s.height/s.scrollHeight*s.height),r.trackHeight=s.height,t(),c.css({overflow:"hidden"}),e.css(k),f.css(n),h.css(l),i.css(m),j.bind("click",v),f[0].addEventListener(o,w,!1),h.on("mousedown",function(a){x=a.pageY-h[0].offsetTop,q.on("mouseup",A),q.on("mousemove",z),a.preventDefault()}),h.on("touchstart",function(a){x=a.originalEvent.changedTouches[0].pageY-h[0].offsetTop,q.on("touchend",C),q.on("touchmove",B),a.preventDefault()}),b?(p.bottom=!1,r.top=parseInt(s.height,10)-parseInt(r.height,10)):r.top=Math.max(0,Math.min(parseInt(s.height,10)-parseInt(r.height,10),parseInt(r.top,10))),u()):(a.showYScrollbar=!1,a.$emit("scrollbar.hide"),h.off("mousedown"),f[0].removeEventListener(o,w,!1),f.attr("style","position:relative;top:0"),e.css({height:"100%"}))},E=function(b,c){null!=o&&clearTimeout(o);var d=!!c&&!!c.rollToBottom;o=setTimeout(function(){s.height=null,D(d),a.$$phase||a.$digest(),a.$parent.$$phase||a.$parent.$digest()},72)};D(),d.rebuildOn&&d.rebuildOn.split(" ").forEach(function(b){a.$on(b,E)}),d.hasOwnProperty("rebuildOnResize")&&q.on("resize",E)},template:'<div><div class="ngsb-wrap"><div class="ngsb-container" ng-transclude></div><div class="ngsb-scrollbar" style="position: absolute; display: block;" ng-show="showYScrollbar"><div class="ngsb-thumb-container"><div class="ngsb-thumb-pos" oncontextmenu="return false;"><div class="ngsb-thumb" ></div></div><div class="ngsb-track"></div></div></div></div></div>'}}]);